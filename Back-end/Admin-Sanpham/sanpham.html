<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product List</title>
    <link rel="stylesheet" href="sanpham.css" />
  </head>
  <body>
    <div id="content">
      <h2>Quản lí sản phẩm</h2>
      <a href="add.html" class="add-product-button">Thêm sản phẩm</a>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Tên sản phẩm</th>
              <th>Ảnh sản phẩm</th>
              <th>Giá</th>
              <th>Mô tả</th>
              <th>Size</th>
              <th>Danh mục</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="product-table-body"></tbody>
        </table>
      </div>
    </div>

    <script>
      async function loadProducts() {
        try {
          const response = await fetch("http://localhost:3000/products");
          const data = await response.json();

          const products = data;
          const tableBody = document.getElementById("product-table-body");

          products.forEach((product) => {
            const row = document.createElement("tr");

            row.innerHTML = `
          <td>${product.id}</td>
          <td>${product.name}</td>
          <td>${
            product.image
              ? `<img src="${product.image}" alt="Ảnh sản phẩm" width="50">`
              : "Không có ảnh"
          }</td>
          <td>${product.price}</td>
          <td>${product.description}</td>
          <td>${product.size}</td>
          <td>${product.category}</td>
          <td>
            <button class="edit-button" data-id="${product.id}">Sửa</button> 
            <button class="delete-button" data-id="${product.id}">Xóa</button>
          </td>
        `;

            tableBody.appendChild(row);
          });

          // Gán sự kiện cho các nút "Sửa"
          const editButtons = document.querySelectorAll(".edit-button");
          editButtons.forEach((button) => {
            button.addEventListener("click", function () {
              const productId = this.getAttribute("data-id");
              window.location.href = `edit.html?id=${productId}`;
            });
          });

          // Gán sự kiện cho các nút "Xóa"
          const deleteButtons = document.querySelectorAll(".delete-button");
          deleteButtons.forEach((button) => {
            button.addEventListener("click", async function () {
              const productId = this.getAttribute("data-id");
              const confirmDelete = confirm(
                "Bạn có chắc chắn muốn xóa sản phẩm này không?"
              );
              if (confirmDelete) {
                await deleteProduct(productId);
                window.location.reload();
              }
            });
          });
        } catch (error) {
          console.error("Lỗi khi tải sản phẩm:", error);
        }
      }

      // Hàm gửi yêu cầu DELETE để xóa sản phẩm
      async function deleteProduct(productId) {
        try {
          const response = await fetch(
            `http://localhost:3000/products/${productId}`,
            {
              method: "DELETE",
            }
          );

          if (response.ok) {
            alert("Sản phẩm đã được xóa thành công!");
          } else {
            alert("Có lỗi xảy ra khi xóa sản phẩm.");
          }
        } catch (error) {
          console.error("Lỗi khi xóa sản phẩm:", error);
        }
      }

      window.onload = loadProducts;
    </script>
  </body>
</html>
