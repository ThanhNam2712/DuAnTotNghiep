<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sửa sản phẩm</title>
    <link rel="stylesheet" href="add.css" />
  </head>
  <body>
    <div id="content">
      <h2>Sửa sản phẩm</h2>
      <form id="form-edit-product">
        <label for="edit-name">Tên sản phẩm</label>
        <input type="text" id="edit-name" required />

        <label for="edit-price">Giá sản phẩm</label>
        <input type="number" id="edit-price" required />

        <label for="edit-category">Danh mục sản phẩm</label>
        <select id="edit-category" required>
          <option value="polo">Polo</option>
          <option value="phong">Phông</option>
          <option value="quan">Quần ngố</option>
        </select>

        <label for="edit-image">Ảnh sản phẩm</label>
        <input type="file" id="edit-image" accept="image/*" />

        <label for="edit-description">Mô tả sản phẩm</label>
        <textarea id="edit-description" rows="4"></textarea>

        <input type="submit" value="Cập nhật" />
      </form>
    </div>

    <script>
      // Hàm để lấy ID sản phẩm từ URL
      function getProductIdFromURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get("id");
      }

      // Tải sản phẩm để chỉnh sửa
      async function loadProductForEdit() {
        const productId = getProductIdFromURL();
        if (!productId) return;

        try {
          const response = await fetch(
            `http://localhost:3000/products/${productId}`
          );
          const product = await response.json();

          document.getElementById("edit-name").value = product.name;
          document.getElementById("edit-price").value = product.price;
          document.getElementById("edit-category").value = product.category;
          document.getElementById("edit-description").value =
            product.description;
        } catch (error) {
          console.error("Lỗi khi tải thông tin sản phẩm:", error);
        }
      }

      // Cập nhật sản phẩm
      async function updateProduct() {
        const productId = getProductIdFromURL();
        const updatedProduct = {
          name: document.getElementById("edit-name").value,
          price: document.getElementById("edit-price").value,
          category: document.getElementById("edit-category").value,
          description: document.getElementById("edit-description").value,
        };

        try {
          const response = await fetch(
            `http://localhost:3000/products/${productId}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(updatedProduct),
            }
          );

          if (response.ok) {
            alert("Sản phẩm đã được cập nhật thành công!");
            window.location.href = "sanpham.html";
          } else {
            alert("Có lỗi xảy ra khi cập nhật sản phẩm.");
          }
        } catch (error) {
          console.error("Lỗi khi cập nhật sản phẩm:", error);
        }
      }

      document
        .getElementById("form-edit-product")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          updateProduct();
        });

      window.onload = loadProductForEdit;
    </script>
  </body>
</html>
